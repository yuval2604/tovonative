{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import{Platform}from'@unimodules/core';import*as FileSystem from'expo-file-system';import Constants from'expo-constants';import computeMd5 from'blueimp-md5';import{getAssetByID}from\"./AssetRegistry\";import resolveAssetSource from\"./resolveAssetSource\";import*as AssetSources from\"./AssetSources\";import*as AssetUris from\"./AssetUris\";import*as EmbeddedAssets from\"./EmbeddedAssets\";import*as ImageAssets from\"./ImageAssets\";var IS_MANAGED_ENV=!!Constants.appOwnership;export var Asset=function(){function Asset(_ref){var name=_ref.name,type=_ref.type,_ref$hash=_ref.hash,hash=_ref$hash===void 0?null:_ref$hash,uri=_ref.uri,width=_ref.width,height=_ref.height;_classCallCheck(this,Asset);this.hash=null;this.localUri=null;this.width=null;this.height=null;this.downloading=false;this.downloaded=false;this._downloadCallbacks=[];this.name=name;this.type=type;this.hash=hash;this.uri=uri;if(typeof width==='number'){this.width=width;}if(typeof height==='number'){this.height=height;}if(IS_MANAGED_ENV&&hash){this.localUri=EmbeddedAssets.getEmbeddedAssetUri(hash,type);if(this.localUri){this.downloaded=true;}}}_createClass(Asset,[{key:\"_downloadAsyncWeb\",value:function _downloadAsyncWeb(){var _ref2,width,height,name;return _regeneratorRuntime.async(function _downloadAsyncWeb$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!ImageAssets.isImageType(this.type)){_context.next=12;break;}_context.next=3;return _regeneratorRuntime.awrap(ImageAssets.getImageInfoAsync(this.uri));case 3:_ref2=_context.sent;width=_ref2.width;height=_ref2.height;name=_ref2.name;this.width=width;this.height=height;this.name=name;_context.next=13;break;case 12:this.name=AssetUris.getFilename(this.uri);case 13:this.localUri=this.uri;case 14:case\"end\":return _context.stop();}}},null,this);}},{key:\"_downloadAsyncManagedEnv\",value:function _downloadAsyncManagedEnv(){var cacheFileId,localUri,_ref3,exists,md5,_ref4;return _regeneratorRuntime.async(function _downloadAsyncManagedEnv$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:cacheFileId=this.hash||computeMd5(this.uri);localUri=FileSystem.cacheDirectory+\"ExponentAsset-\"+cacheFileId+\".\"+this.type;_context2.next=4;return _regeneratorRuntime.awrap(FileSystem.getInfoAsync(localUri,{md5:true}));case 4:_ref3=_context2.sent;exists=_ref3.exists;md5=_ref3.md5;if(!(!exists||this.hash!==null&&md5!==this.hash)){_context2.next=14;break;}_context2.next=10;return _regeneratorRuntime.awrap(FileSystem.downloadAsync(this.uri,localUri,{md5:true}));case 10:_ref4=_context2.sent;md5=_ref4.md5;if(!(this.hash!==null&&md5!==this.hash)){_context2.next=14;break;}throw new Error(\"Downloaded file for asset '\"+this.name+\".\"+this.type+\"' \"+(\"Located at \"+this.uri+\" \")+\"failed MD5 integrity check\");case 14:this.localUri=localUri;case 15:case\"end\":return _context2.stop();}}},null,this);}},{key:\"_downloadAsyncUnmanagedEnv\",value:function _downloadAsyncUnmanagedEnv(){var cacheFileId,localUri;return _regeneratorRuntime.async(function _downloadAsyncUnmanagedEnv$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!this.uri.startsWith('file://')){_context3.next=3;break;}this.localUri=this.uri;return _context3.abrupt(\"return\");case 3:cacheFileId=this.hash||computeMd5(this.uri);localUri=FileSystem.cacheDirectory+\"ExponentAsset-\"+cacheFileId+\".\"+this.type;_context3.next=7;return _regeneratorRuntime.awrap(FileSystem.downloadAsync(this.uri,localUri));case 7:this.localUri=localUri;case 8:case\"end\":return _context3.stop();}}},null,this);}},{key:\"downloadAsync\",value:function downloadAsync(){var _this=this;return _regeneratorRuntime.async(function downloadAsync$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!this.downloaded){_context4.next=2;break;}return _context4.abrupt(\"return\");case 2:if(!this.downloading){_context4.next=6;break;}_context4.next=5;return _regeneratorRuntime.awrap(new Promise(function(resolve,reject){_this._downloadCallbacks.push({resolve:resolve,reject:reject});}));case 5:return _context4.abrupt(\"return\");case 6:this.downloading=true;_context4.prev=7;if(!(Platform.OS==='web')){_context4.next=13;break;}_context4.next=11;return _regeneratorRuntime.awrap(this._downloadAsyncWeb());case 11:_context4.next=20;break;case 13:if(!IS_MANAGED_ENV){_context4.next=18;break;}_context4.next=16;return _regeneratorRuntime.awrap(this._downloadAsyncManagedEnv());case 16:_context4.next=20;break;case 18:_context4.next=20;return _regeneratorRuntime.awrap(this._downloadAsyncUnmanagedEnv());case 20:this.downloaded=true;this._downloadCallbacks.forEach(function(_ref5){var resolve=_ref5.resolve;return resolve();});_context4.next=28;break;case 24:_context4.prev=24;_context4.t0=_context4[\"catch\"](7);this._downloadCallbacks.forEach(function(_ref6){var reject=_ref6.reject;return reject(_context4.t0);});throw _context4.t0;case 28:_context4.prev=28;this.downloading=false;this._downloadCallbacks=[];return _context4.finish(28);case 32:case\"end\":return _context4.stop();}}},null,this,[[7,24,28,32]]);}}],[{key:\"loadAsync\",value:function loadAsync(moduleId){var moduleIds=Array.isArray(moduleId)?moduleId:[moduleId];return Promise.all(moduleIds.map(function(moduleId){return Asset.fromModule(moduleId).downloadAsync();}));}},{key:\"fromModule\",value:function fromModule(virtualAssetModule){if(typeof virtualAssetModule==='string'){return Asset.fromURI(virtualAssetModule);}var meta=getAssetByID(virtualAssetModule);if(!meta){throw new Error(\"Module \\\"\"+virtualAssetModule+\"\\\" is missing from the asset registry\");}if(!IS_MANAGED_ENV){var _resolveAssetSource=resolveAssetSource(virtualAssetModule),uri=_resolveAssetSource.uri;var asset=new Asset({name:meta.name,type:meta.type,hash:meta.hash,uri:uri,width:meta.width,height:meta.height});if(Platform.OS==='android'&&!uri.includes(':')&&(meta.width||meta.height)){asset.localUri=asset.uri;asset.downloaded=true;}Asset.byHash[meta.hash]=asset;return asset;}return Asset.fromMetadata(meta);}},{key:\"fromMetadata\",value:function fromMetadata(meta){var metaHash=meta.hash;if(Asset.byHash[metaHash]){return Asset.byHash[metaHash];}else if(!IS_MANAGED_ENV&&!Asset.byHash[metaHash]){throw new Error('Assets must be initialized with Asset.fromModule');}var _AssetSources$selectA=AssetSources.selectAssetSource(meta),uri=_AssetSources$selectA.uri,hash=_AssetSources$selectA.hash;var asset=new Asset({name:meta.name,type:meta.type,hash:hash,uri:uri,width:meta.width,height:meta.height});Asset.byHash[metaHash]=asset;return asset;}},{key:\"fromURI\",value:function fromURI(uri){if(Asset.byUri[uri]){return Asset.byUri[uri];}var type='';if(uri.indexOf(';base64')>-1){type=uri.split(';')[0].split('/')[1];}else{var extension=AssetUris.getFileExtension(uri);type=extension.startsWith('.')?extension.substring(1):extension;}var asset=new Asset({name:'',type:type,hash:null,uri:uri});Asset.byUri[uri]=asset;return asset;}}]);return Asset;}();Asset.byHash={};Asset.byUri={};","map":{"version":3,"sources":["../src/Asset.ts"],"names":[],"mappings":"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","sourcesContent":["import { Platform } from '@unimodules/core';\nimport * as FileSystem from 'expo-file-system';\nimport Constants from 'expo-constants';\nimport computeMd5 from 'blueimp-md5';\nimport { getAssetByID } from './AssetRegistry';\nimport resolveAssetSource from './resolveAssetSource';\n\nimport * as AssetSources from './AssetSources';\nimport * as AssetUris from './AssetUris';\nimport * as EmbeddedAssets from './EmbeddedAssets';\nimport * as ImageAssets from './ImageAssets';\n\ntype AssetDescriptor = {\n  name: string;\n  type: string;\n  hash?: string | null;\n  uri: string;\n  width?: number | null;\n  height?: number | null;\n};\n\ntype DownloadPromiseCallbacks = {\n  resolve: () => void;\n  reject: (error: Error) => void;\n};\n\nexport type AssetMetadata = AssetSources.AssetMetadata;\n\nconst IS_MANAGED_ENV = !!Constants.appOwnership;\n\nexport class Asset {\n  static byHash = {};\n  static byUri = {};\n\n  name: string;\n  type: string;\n  hash: string | null = null;\n  uri: string;\n  localUri: string | null = null;\n  width: number | null = null;\n  height: number | null = null;\n  downloading: boolean = false;\n  downloaded: boolean = false;\n  _downloadCallbacks: DownloadPromiseCallbacks[] = [];\n\n  constructor({ name, type, hash = null, uri, width, height }: AssetDescriptor) {\n    this.name = name;\n    this.type = type;\n    this.hash = hash;\n    this.uri = uri;\n\n    if (typeof width === 'number') {\n      this.width = width;\n    }\n    if (typeof height === 'number') {\n      this.height = height;\n    }\n\n    // This only applies to assets that are bundled in Expo standalone apps\n    if (IS_MANAGED_ENV && hash) {\n      this.localUri = EmbeddedAssets.getEmbeddedAssetUri(hash, type);\n      if (this.localUri) {\n        this.downloaded = true;\n      }\n    }\n  }\n\n  static loadAsync(moduleId: number | number[]): Promise<void[]> {\n    const moduleIds = Array.isArray(moduleId) ? moduleId : [moduleId];\n    return Promise.all(moduleIds.map(moduleId => Asset.fromModule(moduleId).downloadAsync()));\n  }\n\n  static fromModule(virtualAssetModule: number | string): Asset {\n    if (typeof virtualAssetModule === 'string') {\n      return Asset.fromURI(virtualAssetModule);\n    }\n\n    const meta = getAssetByID(virtualAssetModule);\n    if (!meta) {\n      throw new Error(`Module \"${virtualAssetModule}\" is missing from the asset registry`);\n    }\n\n    // Outside of the managed env we need the moduleId to initialize the asset\n    // because resolveAssetSource depends on it\n    if (!IS_MANAGED_ENV) {\n      const { uri } = resolveAssetSource(virtualAssetModule);\n      const asset = new Asset({\n        name: meta.name,\n        type: meta.type,\n        hash: meta.hash,\n        uri,\n        width: meta.width,\n        height: meta.height,\n      });\n\n      // TODO: FileSystem should probably support 'downloading' from drawable\n      // resources But for now it doesn't (it only supports raw resources) and\n      // React Native's Image works fine with drawable resource names for\n      // images.\n      if (Platform.OS === 'android' && !uri.includes(':') && (meta.width || meta.height)) {\n        asset.localUri = asset.uri;\n        asset.downloaded = true;\n      }\n\n      Asset.byHash[meta.hash] = asset;\n      return asset;\n    }\n\n    return Asset.fromMetadata(meta);\n  }\n\n  static fromMetadata(meta: AssetMetadata): Asset {\n    // The hash of the whole asset, not to be confused with the hash of a specific file returned\n    // from `selectAssetSource`\n    const metaHash = meta.hash;\n    if (Asset.byHash[metaHash]) {\n      return Asset.byHash[metaHash];\n    } else if (!IS_MANAGED_ENV && !Asset.byHash[metaHash]) {\n      throw new Error('Assets must be initialized with Asset.fromModule');\n    }\n\n    const { uri, hash } = AssetSources.selectAssetSource(meta);\n    const asset = new Asset({\n      name: meta.name,\n      type: meta.type,\n      hash,\n      uri,\n      width: meta.width,\n      height: meta.height,\n    });\n    Asset.byHash[metaHash] = asset;\n    return asset;\n  }\n\n  static fromURI(uri: string): Asset {\n    if (Asset.byUri[uri]) {\n      return Asset.byUri[uri];\n    }\n\n    // Possibly a Base64-encoded URI\n    let type = '';\n    if (uri.indexOf(';base64') > -1) {\n      type = uri.split(';')[0].split('/')[1];\n    } else {\n      const extension = AssetUris.getFileExtension(uri);\n      type = extension.startsWith('.') ? extension.substring(1) : extension;\n    }\n\n    const asset = new Asset({\n      name: '',\n      type,\n      hash: null,\n      uri,\n    });\n\n    Asset.byUri[uri] = asset;\n\n    return asset;\n  }\n\n  async _downloadAsyncWeb(): Promise<void> {\n    if (ImageAssets.isImageType(this.type)) {\n      const { width, height, name } = await ImageAssets.getImageInfoAsync(this.uri);\n      this.width = width;\n      this.height = height;\n      this.name = name;\n    } else {\n      this.name = AssetUris.getFilename(this.uri);\n    }\n    this.localUri = this.uri;\n  }\n\n  async _downloadAsyncManagedEnv(): Promise<void> {\n    const cacheFileId = this.hash || computeMd5(this.uri);\n    const localUri = `${FileSystem.cacheDirectory}ExponentAsset-${cacheFileId}.${this.type}`;\n    let { exists, md5 } = await FileSystem.getInfoAsync(localUri, {\n      md5: true,\n    });\n    if (!exists || (this.hash !== null && md5 !== this.hash)) {\n      ({ md5 } = await FileSystem.downloadAsync(this.uri, localUri, {\n        md5: true,\n      }));\n      if (this.hash !== null && md5 !== this.hash) {\n        throw new Error(\n          `Downloaded file for asset '${this.name}.${this.type}' ` +\n            `Located at ${this.uri} ` +\n            `failed MD5 integrity check`\n        );\n      }\n    }\n\n    this.localUri = localUri;\n  }\n\n  async _downloadAsyncUnmanagedEnv(): Promise<void> {\n    // Bail out if it's already at a file URL because it's already available locally\n    if (this.uri.startsWith('file://')) {\n      this.localUri = this.uri;\n      return;\n    }\n\n    const cacheFileId = this.hash || computeMd5(this.uri);\n    const localUri = `${FileSystem.cacheDirectory}ExponentAsset-${cacheFileId}.${this.type}`;\n    // We don't check the FileSystem for an existing version of the asset and we\n    // also don't perform an integrity check!\n    await FileSystem.downloadAsync(this.uri, localUri);\n    this.localUri = localUri;\n  }\n\n  async downloadAsync(): Promise<void> {\n    if (this.downloaded) {\n      return;\n    }\n    if (this.downloading) {\n      await new Promise((resolve, reject) => {\n        this._downloadCallbacks.push({ resolve, reject });\n      });\n      return;\n    }\n    this.downloading = true;\n\n    try {\n      if (Platform.OS === 'web') {\n        await this._downloadAsyncWeb();\n      } else if (IS_MANAGED_ENV) {\n        await this._downloadAsyncManagedEnv();\n      } else {\n        await this._downloadAsyncUnmanagedEnv();\n      }\n\n      this.downloaded = true;\n      this._downloadCallbacks.forEach(({ resolve }) => resolve());\n    } catch (e) {\n      this._downloadCallbacks.forEach(({ reject }) => reject(e));\n      throw e;\n    } finally {\n      this.downloading = false;\n      this._downloadCallbacks = [];\n    }\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}