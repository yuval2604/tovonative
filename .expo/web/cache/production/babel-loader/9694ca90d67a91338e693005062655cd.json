{"ast":null,"code":"import _toConsumableArray from\"@babel/runtime/helpers/toConsumableArray\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _objectWithoutProperties from\"@babel/runtime/helpers/objectWithoutProperties\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import UUID from'uuid-js';function guardPermission(){if(!('Notification'in window)){throw new Error('The Notification API is not available on this device.');}if(!navigator.serviceWorker){throw new Error('Notifications cannot be sent because the service worker API is not supported on this device.');}if(!navigator.serviceWorker.controller){throw new Error('Notifications cannot be sent because there is no service worker controller registered. Ensure you have SSL certificates enabled.');}if(Notification.permission!=='granted'){throw new Error('Cannot use Notifications without permissions. Please request permissions with `expo-permissions`');}}function transformLocalNotification(notification,tag){var _notification$web=notification.web,web=_notification$web===void 0?{}:_notification$web,abstractNotification=_objectWithoutProperties(notification,[\"web\"]);tag=web.tag||tag;var nativeNotification=_objectSpread({},abstractNotification,{tag:tag},web);return[nativeNotification.title,nativeNotification];}function generateID(){return UUID.create().toString();}function getRegistrationAsync(){var registration;return _regeneratorRuntime.async(function getRegistrationAsync$(_context){while(1){switch(_context.prev=_context.next){case 0:guardPermission();_context.next=3;return _regeneratorRuntime.awrap(navigator.serviceWorker.getRegistration());case 3:registration=_context.sent;if(registration){_context.next=6;break;}throw new Error('Failed to get notification registration!');case 6:return _context.abrupt(\"return\",registration);case 7:case\"end\":return _context.stop();}}});}function getNotificationsAsync(tag){var registration,notifications;return _regeneratorRuntime.async(function getNotificationsAsync$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(getRegistrationAsync());case 2:registration=_context2.sent;_context2.next=5;return _regeneratorRuntime.awrap(registration.getNotifications(tag?{tag:tag}:undefined));case 5:notifications=_context2.sent;return _context2.abrupt(\"return\",notifications);case 7:case\"end\":return _context2.stop();}}});}export default{presentLocalNotification:function presentLocalNotification(notification){var registration,tag;return _regeneratorRuntime.async(function presentLocalNotification$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regeneratorRuntime.awrap(getRegistrationAsync());case 2:registration=_context3.sent;tag=generateID();registration.showNotification.apply(registration,_toConsumableArray(transformLocalNotification(notification,tag)));return _context3.abrupt(\"return\",tag);case 6:case\"end\":return _context3.stop();}}});},scheduleLocalNotification:function scheduleLocalNotification(notification){var options,registration,tag,intervalMs,_args4=arguments;return _regeneratorRuntime.async(function scheduleLocalNotification$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:options=_args4.length>1&&_args4[1]!==undefined?_args4[1]:{};if(!options.intervalMs){_context4.next=10;break;}_context4.next=4;return _regeneratorRuntime.awrap(getRegistrationAsync());case 4:registration=_context4.sent;tag=generateID();setTimeout(function(){registration.showNotification.apply(registration,_toConsumableArray(transformLocalNotification(notification,tag)));},options.intervalMs);return _context4.abrupt(\"return\",tag);case 10:if(!options.time){_context4.next=15;break;}intervalMs=options.time-Date.now();if(!(intervalMs<0)){_context4.next=14;break;}throw new Error('Expo.Notifications.scheduleLocalNotification(): options.time must be some time in the future.');case 14:return _context4.abrupt(\"return\",this.scheduleLocalNotification(notification,{intervalMs:intervalMs}));case 15:throw new Error(\"Expo.Notifications.scheduleLocalNotification() options \"+JSON.stringify(options,null,2)+\" are not supported yet.\");case 16:case\"end\":return _context4.stop();}}},null,this);},dismissNotification:function dismissNotification(notificationId){var notifications,_iterator,_isArray,_i,_ref,_notification;return _regeneratorRuntime.async(function dismissNotification$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return _regeneratorRuntime.awrap(getNotificationsAsync(notificationId));case 2:notifications=_context5.sent;_iterator=notifications,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol===\"function\"?typeof Symbol===\"function\"?Symbol.iterator:\"@@iterator\":\"@@iterator\"]();case 4:if(!_isArray){_context5.next=10;break;}if(!(_i>=_iterator.length)){_context5.next=7;break;}return _context5.abrupt(\"break\",18);case 7:_ref=_iterator[_i++];_context5.next=14;break;case 10:_i=_iterator.next();if(!_i.done){_context5.next=13;break;}return _context5.abrupt(\"break\",18);case 13:_ref=_i.value;case 14:_notification=_ref;_notification.close();case 16:_context5.next=4;break;case 18:case\"end\":return _context5.stop();}}});},dismissAllNotifications:function dismissAllNotifications(){return _regeneratorRuntime.async(function dismissAllNotifications$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:this.dismissNotification();case 1:case\"end\":return _context6.stop();}}},null,this);},cancelScheduledNotificationAsync:function cancelScheduledNotificationAsync(notificationId){return _regeneratorRuntime.async(function cancelScheduledNotificationAsync$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:this.dismissNotification(notificationId);case 1:case\"end\":return _context7.stop();}}},null,this);},cancelAllScheduledNotificationsAsync:function cancelAllScheduledNotificationsAsync(){return _regeneratorRuntime.async(function cancelAllScheduledNotificationsAsync$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:this.dismissNotification();case 1:case\"end\":return _context8.stop();}}},null,this);}};","map":{"version":3,"sources":["../../src/Notifications/ExponentNotifications.web.ts"],"names":[],"mappings":"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","sourcesContent":["import UUID from 'uuid-js';\n\nimport { LocalNotification, LocalNotificationId } from './Notifications.types';\n\nfunction guardPermission() {\n  if (!('Notification' in window)) {\n    throw new Error('The Notification API is not available on this device.');\n  }\n  if (!navigator.serviceWorker) {\n    throw new Error(\n      'Notifications cannot be sent because the service worker API is not supported on this device.'\n    );\n  }\n  if (!navigator.serviceWorker.controller) {\n    throw new Error(\n      'Notifications cannot be sent because there is no service worker controller registered. Ensure you have SSL certificates enabled.'\n    );\n  }\n  if (Notification.permission !== 'granted') {\n    throw new Error(\n      'Cannot use Notifications without permissions. Please request permissions with `expo-permissions`'\n    );\n  }\n}\n\nfunction transformLocalNotification(\n  notification: LocalNotification,\n  tag: string\n): [string, NotificationOptions] {\n  const { web = {}, ...abstractNotification } = notification;\n  tag = web.tag || tag;\n  const nativeNotification = {\n    ...abstractNotification,\n    tag,\n    ...web,\n  };\n  return [nativeNotification.title, nativeNotification];\n}\n\nfunction generateID(): string {\n  return UUID.create().toString();\n}\n\nasync function getRegistrationAsync(): Promise<ServiceWorkerRegistration> {\n  guardPermission();\n  const registration = await navigator.serviceWorker.getRegistration();\n  if (!registration) {\n    throw new Error('Failed to get notification registration!');\n  }\n  return registration;\n}\n\nasync function getNotificationsAsync(tag?: string): Promise<Notification[]> {\n  const registration = await getRegistrationAsync();\n  const notifications = await registration.getNotifications(tag ? { tag } : undefined);\n  return notifications;\n}\n\nexport default {\n  async presentLocalNotification(notification: LocalNotification): Promise<LocalNotificationId> {\n    const registration = await getRegistrationAsync();\n    const tag = generateID();\n    registration.showNotification(...transformLocalNotification(notification, tag));\n    return tag;\n  },\n  async scheduleLocalNotification(\n    notification: any,\n    options: {\n      time?: Date | number;\n      repeat?: 'minute' | 'hour' | 'day' | 'week' | 'month' | 'year';\n      intervalMs?: number;\n    } = {}\n  ): Promise<string> {\n    if (options.intervalMs) {\n      const registration = await getRegistrationAsync();\n      const tag = generateID();\n      setTimeout(() => {\n        registration.showNotification(...transformLocalNotification(notification, tag));\n      }, options.intervalMs);\n      return tag;\n    } else if (options.time) {\n      const intervalMs = (options.time as number) - Date.now();\n      if (intervalMs < 0) {\n        throw new Error(\n          'Expo.Notifications.scheduleLocalNotification(): options.time must be some time in the future.'\n        );\n      }\n      return this.scheduleLocalNotification(notification, {\n        intervalMs,\n      });\n    }\n    throw new Error(\n      `Expo.Notifications.scheduleLocalNotification() options ${JSON.stringify(\n        options,\n        null,\n        2\n      )} are not supported yet.`\n    );\n  },\n\n  async dismissNotification(notificationId?: string): Promise<void> {\n    const notifications = await getNotificationsAsync(notificationId);\n    for (const notification of notifications) {\n      notification.close();\n    }\n  },\n  async dismissAllNotifications(): Promise<void> {\n    this.dismissNotification();\n  },\n  async cancelScheduledNotificationAsync(notificationId: string): Promise<void> {\n    this.dismissNotification(notificationId);\n  },\n  async cancelAllScheduledNotificationsAsync(): Promise<void> {\n    this.dismissNotification();\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}